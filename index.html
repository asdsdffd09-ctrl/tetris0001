<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë°”ì¼ í†µí•© í…ŒíŠ¸ë¦¬ìŠ¤</title>
    
    <style>
        /*
         * CSS ìŠ¤íƒ€ì¼ë§
         */
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* í™”ë©´ ìƒë‹¨ë¶€í„° ì‹œì‘ */
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #2c3e50; /* ì–´ë‘ìš´ ë°°ê²½ */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ecf0f1;
            padding-top: 20px;
        }

        #game-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            max-width: 400px; 
            width: 90%; /* í™”ë©´ ë„ˆë¹„ì— ë°˜ì‘ */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            background-color: #34495e;
            padding: 15px;
        }

        /* ì •ë³´ íŒ¨ë„ */
        #info-panel {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 5px 10px;
            background-color: #2980b9;
            border-radius: 5px;
        }

        #info-panel p {
            margin: 0;
            font-size: 1.1em;
            font-weight: bold;
        }

        #start-button {
            padding: 8px 15px;
            font-size: 1em;
            font-weight: bold;
            background-color: #f39c12;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #start-button:hover {
            background-color: #e67e22;
        }

        /* ê²Œì„ ë³´ë“œ ìŠ¤íƒ€ì¼ë§ (10x20) */
        #grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr); /* 10ì—´ */
            width: 100%;
            /* ë†’ì´ë¥¼ ë„ˆë¹„ì˜ 2ë°°ë¡œ ì„¤ì •í•˜ì—¬ 10x20 ë¹„ìœ¨ ìœ ì§€ */
            aspect-ratio: 1 / 2; 
            border: 5px solid #2c3e50;
            background-color: #1c2833;
        }

        /* ê°œë³„ ì…€(ë¸”ë¡) ìŠ¤íƒ€ì¼ë§ */
        .square {
            border: 1px solid rgba(255, 255, 255, 0.05); 
            box-sizing: border-box; /* íŒ¨ë”©ê³¼ ê²½ê³„ë¥¼ ë„ˆë¹„ì— í¬í•¨ */
        }

        /* ëª¨ë°”ì¼ ì¡°ì‘ ë²„íŠ¼ */
        #controls {
            display: grid;
            grid-template-areas: 
                ". rotate ."
                "left down right"
                ". drop .";
            gap: 10px;
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            background-color: #34495e;
            border-radius: 10px;
        }

        #controls button {
            padding: 15px;
            font-size: 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            /* ëª¨ë°”ì¼ í„°ì¹˜ ë°˜ì‘ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ */
            -webkit-tap-highlight-color: transparent; 
            transition: background-color 0.1s;
        }

        #controls button:active {
            opacity: 0.8;
        }

        #rotate-button { grid-area: rotate; }
        #left-button { grid-area: left; }
        #right-button { grid-area: right; }
        #down-button { grid-area: down; }
        #drop-button { grid-area: drop; background-color: #e74c3c; }
    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="info-panel">
            <p>Score: <span id="score">0</span></p>
            <p>Next: <div id="next-tetromino" style="display:inline-block;"></div></p>
            <button id="start-button">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="grid">
            </div>
        
        <div id="controls">
            <button id="rotate-button">ğŸ”„</button>
            <button id="left-button">â—€ï¸</button>
            <button id="right-button">â–¶ï¸</button>
            <button id="down-button">â¬‡ï¸</button>
            <button id="drop-button">ğŸ”¥</button>
        </div>
    </div>

    <script>
        //
        // JAVASCRIPT ë¡œì§
        //

        const grid = document.getElementById('grid');
        const scoreDisplay = document.getElementById('score');
        const startButton = document.getElementById('start-button');
        
        // ê²Œì„ ì„¤ì •
        const width = 10;
        const height = 20;
        let score = 0;
        let squares = []; // ê²Œì„ ë³´ë“œì˜ DOM ìš”ì†Œ ì €ì¥ ë°°ì—´

        // 1. ê²Œì„ ë³´ë“œ ì´ˆê¸°í™” ë° ë Œë”ë§
        function createBoard() {
            for (let i = 0; i < width * height; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
                squares.push(square);
            }
        }
        createBoard();

        // ** ì‹¤ì œ í…ŒíŠ¸ë¦¬ìŠ¤ ë¸”ë¡ ë°ì´í„° (7ê°€ì§€ ëª¨ì–‘) **
        // L, J, T, I, O, S, Z (0ìœ¼ë¡œ íšŒì „ ìƒíƒœ)
        const theTetrominoes = [
            // L-Tetromino
            [[1, width + 1, width * 2 + 1, 2], [width, width + 1, width + 2, width * 2 + 2], [1, width + 1, width * 2 + 1, width * 2], [width, width * 2, width * 2 + 1, width * 2 + 2]],
            // J-Tetromino
            [[1, width + 1, width * 2 + 1, 0], [width, width * 2, width * 2 + 1, width * 2 + 2], [1, width + 1, width * 2 + 1, width * 2 + 2], [width, width + 1, width + 2, width * 2]],
            // T-Tetromino
            [[1, width, width + 1, width + 2], [1, width + 1, width * 2 + 1, width], [width, width + 1, width + 2, width * 2 + 1], [1, width + 1, width * 2 + 1, width + 2]],
            // I-Tetromino
            [[1, width + 1, width * 2 + 1, width * 3 + 1], [width, width + 1, width + 2, width + 3], [1, width + 1, width * 2 + 1, width * 3 + 1], [width, width + 1, width + 2, width + 3]],
            // O-Tetromino
            [[0, 1, width, width + 1], [0, 1, width, width + 1], [0, 1, width, width + 1], [0, 1, width, width + 1]],
            // S-Tetromino
            [[width, width + 1, 1, 2], [0, width, width + 1, width * 2 + 1], [width, width + 1, 1, 2], [0, width, width + 1, width * 2 + 1]],
            // Z-Tetromino
            [[0, 1, width + 1, width + 2], [1, width, width + 1, width * 2], [0, 1, width + 1, width + 2], [1, width, width + 1, width * 2]]
        ];
        
        const colors = ['#e74c3c', '#3498db', '#9b59b6', '#f1c40f', '#2ecc71', '#e67e22', '#1abc9c'];

        let currentPosition = 4; // ë¸”ë¡ì˜ ì‹œì‘ ìœ„ì¹˜ (ìƒë‹¨ ì¤‘ì•™)
        let currentRotation = 0;
        let random = Math.floor(Math.random() * theTetrominoes.length);
        let current = theTetrominoes[random][currentRotation];
        let currentColor = colors[random];
        let timerId;

        // ë¸”ë¡ ê·¸ë¦¬ê¸°
        function draw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.add('tetromino');
                squares[currentPosition + index].style.backgroundColor = currentColor;
            });
        }

        // ë¸”ë¡ ì§€ìš°ê¸°
        function undraw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.remove('tetromino');
                squares[currentPosition + index].style.backgroundColor = '';
            });
        }

        // ** 2. í•µì‹¬ ë¡œì§: ì´ë™ ë° ì¶©ëŒ ê°ì§€ (placeholder) **

        // ì¶©ëŒ ê°ì§€ í•¨ìˆ˜ (ì½”ë“œë¥¼ ì™„ì„±í•´ì•¼ í•  ë¶€ë¶„)
        function checkCollision(newPosition, tetromino) {
            // TODO: ìƒˆë¡œìš´ ìœ„ì¹˜(newPosition)ì—ì„œ tetrominoê°€
            // 1. ë³´ë“œ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ëŠ”ì§€ í™•ì¸ (ì¢Œ/ìš°/ë°”ë‹¥)
            // 2. ì´ë¯¸ ê³ ì •ëœ ë¸”ë¡ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
            // ì¶©ëŒí•˜ë©´ true, ì•„ë‹ˆë©´ false ë°˜í™˜
            return false; 
        }

        // ë¸”ë¡ ì´ë™
        function move(direction) {
            undraw();
            const newPosition = currentPosition + direction;
            if (!checkCollision(newPosition, current)) {
                currentPosition = newPosition;
            }
            draw();
        }

        // ë¸”ë¡ íšŒì „
        function rotate() {
            undraw();
            let nextRotation = (currentRotation + 1) % current.length;
            let nextTetromino = theTetrominoes[random][nextRotation];
            
            // TODO: íšŒì „ í›„ ì¶©ëŒ ì²´í¬ ë° 'ë²½ì°¨ê¸°(Wall Kick)' ë¡œì§ êµ¬í˜„
            if (!checkCollision(currentPosition, nextTetromino)) {
                currentRotation = nextRotation;
                current = nextTetromino;
            }
            draw();
        }
        
        // ë¸”ë¡ í•œ ì¹¸ ë“œë¡­
        function drop() {
            undraw();
            const newPosition = currentPosition + width; // ì•„ë˜ë¡œ í•œ ì¹¸
            
            if (checkCollision(newPosition, current)) {
                // TODO: ì¶©ëŒ ë°œìƒ ì‹œ
                // 1. ë¸”ë¡ì„ ë³´ë“œì— 'ê³ ì •'í•˜ëŠ” merge í•¨ìˆ˜ í˜¸ì¶œ
                // 2. ì¤„ ì œê±° clearLines í•¨ìˆ˜ í˜¸ì¶œ
                // 3. ìƒˆ ë¸”ë¡ ìƒì„± newTetromino í•¨ìˆ˜ í˜¸ì¶œ
                console.log('Block Merged!');
                // clearInterval(timerId); // ì„ì‹œ ì¤‘ë‹¨
            } else {
                currentPosition = newPosition;
            }
            draw();
        }


        // ** 3. ëª¨ë°”ì¼ ì¡°ì‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ **

        document.getElementById('rotate-button').addEventListener('click', () => {
            rotate();
        });

        document.getElementById('left-button').addEventListener('click', () => {
            move(-1); // -1: ì™¼ìª½ í•œ ì¹¸ ì´ë™
        });

        document.getElementById('right-button').addEventListener('click', () => {
            move(1); // 1: ì˜¤ë¥¸ìª½ í•œ ì¹¸ ì´ë™
        });
        
        document.getElementById('down-button').addEventListener('click', () => {
            // soft drop (ë¶€ë“œëŸ½ê²Œ í•œ ì¹¸ì”© ë‚´ë¦¬ê¸°)
            drop();
        });

        document.getElementById('drop-button').addEventListener('click', () => {
            // TODO: hard drop (ë°”ë‹¥ê¹Œì§€ í•œ ë²ˆì— ë‚´ë¦¬ê¸°) ë¡œì§ êµ¬í˜„
            console.log('Hard Drop!');
        });
        
        startButton.addEventListener('click', () => {
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
                startButton.textContent = 'ì¬ê°œ';
            } else {
                // ê²Œì„ ì‹œì‘
                if (!timerId) {
                    // draw(); // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸° ë¸”ë¡ ê·¸ë¦¬ê¸°
                    timerId = setInterval(drop, 1000); // 1ì´ˆë§ˆë‹¤ drop
                    startButton.textContent = 'ì¼ì‹œì •ì§€';
                }
            }
        });

        // ì´ˆê¸° ì‹œì‘
        draw(); 
    </script>
</body>
</html>
